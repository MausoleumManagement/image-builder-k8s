# where image builder will contact the Proxmox-API
export PROXMOX_URL="https://pve020.irminsul:8006/api2/json"

# network interface the VM will use
export PROXMOX_BRIDGE="vmbr0"

# where the VM will run
export PROXMOX_NODE="pve020"

# where the base VM image will be stored
# isos can not be stored on rbd
# https://forum.proxmox.com/threads/isos-on-rbd.18031/
export PROXMOX_ISO_POOL="pve022-nfs-general"

# where the building-VM and the resulting template will be stored
export PROXMOX_STORAGE_POOL="ceph_ssd_replicated"

# visiting here
# https://build.opensuse.org/project/subprojects/isv:kubernetes:core:stable
# we can find the repository for each version, such as here
# https://build.opensuse.org/repositories/isv:kubernetes:core:stable:v1.30
# by visiting the published deb repository, we can visit the download repo here
# https://download.opensuse.org/repositories/isv:/kubernetes:/core:/stable:/v1.30/deb/amd64/
# and that is where the funny extra version in the deb packages is derived from
# see also https://image-builder.sigs.k8s.io/capi/providers/proxmox#configuration
# The full list of available environment vars can be found in the variables section of images/capi/packer/proxmox/packer.json.tmpl
export PACKER_FLAGS="--var 'kubernetes_semver=v1.32.9' --var 'kubernetes_series=v1.32' --var 'kubernetes_deb_version=1.32.9-1.1'"

# increase the building VMs memory available resources so we have some breathing room
export PACKER_FLAGS="$PACKER_FLAGS --var memory=8192 --var cpus=4"

# This will set the Processor Type setting of the VM template (and hence all VMs created from it)
# more specific settings yield better performance but prevent live migrations (which we usually don't use)
# between hosts with incompatible CPU instruction sets
# kvm64 - Default setting for the Packer Plugin; Most compatible (Phenom and up), but least performant
# x86-64-v3 - This is the highest setting EPYC 7551 CPUs will support
# EPYC-v3 - See above, but vendor specific
# host - Passes the host's CPU to the VM, most specific, most performant
export PACKER_FLAGS="$PACKER_FLAGS --var cpu_type=x86-64-v3"

# set a custom name
export PACKER_FLAGS="$PACKER_FLAGS --var artifact_name=kube-template-v1.32.9"
